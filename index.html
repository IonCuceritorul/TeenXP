<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TeenXP Jobs</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body { font-family: Arial; background: #f7f7f7; }
header { background: #4CAF50; color: white; padding: 15px; }
main { max-width: 800px; margin: auto; }
.job { background: white; padding: 10px; margin: 10px 0; border-radius: 5px; }
button { padding: 5px 10px; cursor: pointer; }
</style>
</head>

<body>
<header>
    <h2 id="welcome"></h2>
    <button id="logout">Logout</button>
</header>

<main>
<h3>Postează un job</h3>
<input id="title" placeholder="Titlu"><br><br>
<input id="desc" placeholder="Descriere"><br><br>
<input id="reward" placeholder="Recompensă"><br><br>
<button id="addJob">Adaugă Job</button>

<h3>Joburi disponibile</h3>
<div id="jobs"></div>
</main>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyALiRJPLBGmPSwfJ0oEhzt30KmYol9Fn6A",
  authDomain: "teenxp-dc30f.firebaseapp.com",
  databaseURL: "https://teenxp-dc30f-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "teenxp-dc30f",
  storageBucket: "teenxp-dc30f.firebasestorage.app",
  messagingSenderId: "148552569998",
  appId: "1:148552569998:web:81f1bac595865ece40e5df"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

auth.onAuthStateChanged(user => {
    if(!user) window.location.href = "login.html";

    db.ref('users/' + user.uid).once('value').then(snap => {
        document.getElementById('welcome').innerText =
            "Salut, " + snap.val().username;
    });
});

document.getElementById('logout').onclick = () => auth.signOut();

document.getElementById('addJob').onclick = () => {
    const title = document.getElementById('title').value;
    const desc = document.getElementById('desc').value;
    const reward = document.getElementById('reward').value;
    const user = auth.currentUser;

    db.ref('users/' + user.uid).once('value').then(snap => {
        db.ref('jobs').push({
            title, desc, reward,
            postedBy: user.uid,
            posterUsername: snap.val().username,
            takenBy: null
        });
    });
};

db.ref('jobs').on('value', snap => {
    const jobsDiv = document.getElementById('jobs');
    jobsDiv.innerHTML = "";

    snap.forEach(jobSnap => {
        const job = jobSnap.val();
        const div = document.createElement('div');
        div.className = "job";

        div.innerHTML = `
            <strong>${job.title}</strong><br>
            ${job.desc}<br>
            Recompensă: ${job.reward}<br>
            Postat de: ${job.posterUsername}<br>
        `;

        if(!job.takenBy){
            const btn = document.createElement('button');
            btn.innerText = "Accept job";
            btn.onclick = () => {
                db.ref('jobs/' + jobSnap.key)
                  .update({ takenBy: auth.currentUser.uid });
            };
            div.appendChild(btn);
        } else {
            div.innerHTML += "<br><em>Job acceptat</em>";
        }

        jobsDiv.appendChild(div);
    });
});
</script>
</body>
</html>
