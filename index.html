<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pagina Principală</title>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        body { font-family: Arial; margin:0; padding:0; background:#f7f7f7; }
        header { background: #4CAF50; color:white; padding:15px; text-align:center; }
        main { max-width: 900px; margin:20px auto; padding:0 15px; }
        input, button { padding:10px; margin:5px 0; border-radius:5px; border:1px solid #4CAF50; }
        button { background: #4CAF50; color:white; cursor:pointer; }
        button:hover { background: #45a049; }
        .job-card { background:white; padding:15px; margin:10px 0; border-radius:10px; box-shadow:0 0 5px rgba(0,0,0,0.1);}
        .job-card.available { border-left:5px solid green; }
        .job-card.taken { border-left:5px solid red; opacity:0.8; }
        .job-card button { margin-top:10px; }
    </style>
</head>
<body>

<header>
    <h1>Pagina Principală</h1>
    <p id="welcomeMsg"></p>
    <button id="logoutBtn">Logout</button>
</header>

<main>
    <h2>Postează un job</h2>
    <input type="text" id="jobTitle" placeholder="Titlu job"><br>
    <input type="text" id="jobDesc" placeholder="Descriere job"><br>
    <input type="text" id="jobReward" placeholder="Recompensă (ex: 50 RON)"><br>
    <button id="postJobBtn">Postează Job</button>

    <h2>Joburi disponibile</h2>
    <div id="jobList"></div>
</main>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyALiRJPLBGmPSwfJ0oEhzt30KmYol9Fn6A",
        authDomain: "teenxp-dc30f.firebaseapp.com",
        databaseURL: "https://teenxp-dc30f-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "teenxp-dc30f",
        storageBucket: "teenxp-dc30f.firebasestorage.app",
        messagingSenderId: "148552569998",
        appId: "1:148552569998:web:81f1bac595865ece40e5df",
        measurementId: "G-KH13EFMSNT"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    const welcomeMsg = document.getElementById('welcomeMsg');
    const logoutBtn = document.getElementById('logoutBtn');

    const jobTitleInput = document.getElementById('jobTitle');
    const jobDescInput = document.getElementById('jobDesc');
    const jobRewardInput = document.getElementById('jobReward');
    const postJobBtn = document.getElementById('postJobBtn');
    const jobList = document.getElementById('jobList');

    // Redirect if not logged in
    auth.onAuthStateChanged(user => {
        if(user){
            welcomeMsg.innerText = `Salut, ${user.email}!`;
        } else {
            window.location.href = "login.html";
        }
    });

    // Logout
    logoutBtn.addEventListener('click', () => auth.signOut());

    // Post a job
    postJobBtn.addEventListener('click', () => {
        const user = auth.currentUser;
        if(!user) return;

        const title = jobTitleInput.value.trim();
        const desc = jobDescInput.value.trim();
        const reward = jobRewardInput.value.trim();

        if(!title || !desc || !reward){
            alert("Completează toate câmpurile!");
            return;
        }

        const newJobRef = db.ref('jobs').push();
        newJobRef.set({
            title,
            desc,
            reward,
            postedBy: user.uid,
            posterEmail: user.email,
            takenBy: null
        });

        jobTitleInput.value = '';
        jobDescInput.value = '';
        jobRewardInput.value = '';
    });

    // Display jobs
    function displayJobs(jobsData){
        jobList.innerHTML = '';
        const user = auth.currentUser;
        for(const id in jobsData){
            const job = jobsData[id];
            const card = document.createElement('div');
            card.classList.add('job-card');
            card.classList.add(job.takenBy ? 'taken' : 'available');

            card.innerHTML = `
                <strong>${job.title}</strong> - ${job.desc} - ${job.reward}<br>
                Postat de: ${job.posterEmail}<br>
                ${job.takenBy ? `Acceptat de ${job.takenByEmail || job.takenBy}` : ''}
            `;

            // Add accept button if available and not posted by current user
            if(!job.takenBy && job.postedBy !== user.uid){
                const btn = document.createElement('button');
                btn.innerText = 'Acceptă Job';
                btn.addEventListener('click', () => acceptJob(id));
                card.appendChild(btn);
            }

            jobList.appendChild(card);
        }
    }

    // Accept job
    function acceptJob(jobId){
        const user = auth.currentUser;
        if(!user) return;
        const jobRef = db.ref('jobs/' + jobId);
        jobRef.once('value', snapshot => {
            const job = snapshot.val();
            if(job.takenBy){
                alert("Jobul a fost deja acceptat!");
                return;
            }
            jobRef.update({ takenBy: user.uid, takenByEmail: user.email });
        });
    }

    // Listen for real-time job changes
    db.ref('jobs').on('value', snapshot => {
        const jobsData = snapshot.val() || {};
        displayJobs(jobsData);
    });
</script>

</body>
</html>
